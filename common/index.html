#!/usr/bin/env bash
cat >/dev/null << '#sh.djeeno.com'
<link rel="icon" href="/favicon.ico" type="image/x-icon"><style>body{font-size:0;margin:0}code{font-size:1rem;font-family:'Ricty Diminished',Osaka,Menlo,Monaco,Consolas,'Courier New','Andale Mono','Ubuntu Mono',monospace}</style><pre><code>##
#sh.djeeno.com
##

# check bash version
if ! test "${BASH_VERSINFO[0]}" -ge 3; then
  printf '\033[1;31m%s\033[0m\n' "bash 3.x or later is required" 1>&2
  exit 1
fi

# 関数 export
stderrPipeDebug ()  { awk '{print "\033[00m'"$(date +%Y-%m-%dT%H:%M:%S%z)"' [  debug] "$0"\033[0m"}' /dev/stdin 1>&2; } && export -f stderrPipeDebug
stderrPipeNotice () { awk '{print "\033[01m'"$(date +%Y-%m-%dT%H:%M:%S%z)"' [ notice] "$0"\033[0m"}' /dev/stdin 1>&2; } && export -f stderrPipeNotice
stderrPipeError ()  { awk '{print "\033[31m'"$(date +%Y-%m-%dT%H:%M:%S%z)"' [  error] "$0"\033[0m"}' /dev/stdin 1>&2; } && export -f stderrPipeError
stderrPipeOK ()     { awk '{print "\033[32m'"$(date +%Y-%m-%dT%H:%M:%S%z)"' [     ok] "$0"\033[0m"}' /dev/stdin 1>&2; } && export -f stderrPipeOK
stderrPipeWarn ()   { awk '{print "\033[33m'"$(date +%Y-%m-%dT%H:%M:%S%z)"' [warning] "$0"\033[0m"}' /dev/stdin 1>&2; } && export -f stderrPipeWarn
stderrPipeInfo ()   { awk '{print "\033[34m'"$(date +%Y-%m-%dT%H:%M:%S%z)"' [   info] "$0"\033[0m"}' /dev/stdin 1>&2; } && export -f stderrPipeInfo

# CPUアーキテクチャ判定用
export envIsAMD64=false

# カーネル判定用
export envIsDarwin=false
export envIsLinux=false

# Ubuntu
export envIsUbuntu=false
export envIsUbuntu1404=false
export envIsUbuntu1604=false
export envIsUbuntu1804=false

# CentOS
export envIsCentOS=false
export envIsCentOS6=false
export envIsCentOS7=false
export envIsCentOS8=false

# CPU アーキテクチャ判定
if uname -m | grep -q ^x86_64$; then
  envIsAMD64=true
fi

# カーネル判定
if uname -s | grep -q ^Darwin$; then
  envIsDarwin=true
elif uname -s | grep -q ^Linux$; then
  envIsLinux=true
fi

# ディストリビューション及び OS バージョン判定
if grep -q "\"Ubuntu 14\.04.* LTS\"" /etc/lsb-release 2>/dev/null; then
  envIsUbuntu=true
  envIsUbuntu1404=true
elif grep -q "\"Ubuntu 16\.04.* LTS\"" /etc/lsb-release 2>/dev/null; then
  envIsUbuntu=true
  envIsUbuntu1604=true
elif grep -q "\"Ubuntu 18\.04.* LTS\"" /etc/lsb-release 2>/dev/null; then
  envIsUbuntu=true
  envIsUbuntu1804=true
elif grep -q "^CentOS release 6\." /etc/centos-release 2>/dev/null; then
  envIsCentOS=true
  envIsCentOS6=true
elif grep -q "^CentOS Linux release 7\." /etc/centos-release 2>/dev/null; then
  envIsCentOS=true
  envIsCentOS7=true
elif grep -q "^CentOS Linux release 8\." /etc/centos-release 2>/dev/null; then
  envIsCentOS=true
  envIsCentOS8=true
fi

# 読み込み判定用
export envIsLoaded=true

# ログ出力
{ echo 'env:'; env | grep ^envIs | sort | awk '{print "  "$0}'; } | stderrPipeInfo



# (C) 2018 djeeno </code></pre>
